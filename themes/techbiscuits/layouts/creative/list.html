{{ define "main" }}
{{ $categoryGroups := .Pages.GroupByParam "category" }}
{{ $sortedAsc := sort .Pages ".Params.year" "asc" }}
{{ $sortedDesc := sort .Pages ".Params.year" "desc" }}

<section class="creative-gallery" id="creative-gallery">
    <div class="content-container">
        <header class="gallery-header">
            <p class="eyebrow">Creative vault</p>
            <h1 class="gallery-title">Creative Works</h1>
            <p class="gallery-subtitle">A curated collection of poetry, art, and timeless wisdom — ready to flip, skim, and savor.</p>

            <div class="gallery-meta-grid">
                <div class="meta-card">
                    <span class="meta-label">Pieces</span>
                    <span class="meta-value">{{ len .Pages }}</span>
                    <span class="meta-hint">Flip any card to read instantly</span>
                </div>
                <div class="meta-card">
                    <span class="meta-label">Categories</span>
                    <div class="meta-pill-row">
                        {{ range $categoryGroups }}
                        <span class="meta-pill">{{ .Key | default "Uncategorized" | title }}</span>
                        {{ end }}
                    </div>
                </div>
                <div class="meta-card">
                    <span class="meta-label">Timeline</span>
                    {{ if gt (len $sortedAsc) 0 }}
                        <span class="meta-value">
                            {{ with (index $sortedAsc 0) }}{{ .Params.year }}{{ end }} – {{ with (index $sortedDesc 0) }}{{ .Params.year }}{{ end }}
                        </span>
                        <span class="meta-hint">Across {{ len $categoryGroups }} moods</span>
                    {{ else }}
                        <span class="meta-value">Coming soon</span>
                        <span class="meta-hint">Add creative entries to populate the timeline</span>
                    {{ end }}
                </div>
            </div>
        </header>

        <div class="creative-toolbar" aria-label="Creative controls">
            <div class="creative-filters" role="tablist" aria-label="Filter creative works">
                <button class="filter-btn active" data-filter="all" aria-pressed="true">All</button>
                {{ range $categoryGroups }}
                    {{ $filterValue := (urlize (.Key | default "uncategorized")) }}
                    <button class="filter-btn" data-filter="{{ $filterValue }}" aria-pressed="false">
                        {{ .Key | default "Uncategorized" | title }}
                    </button>
                {{ end }}
            </div>

            <div class="creative-controls">
                <div class="control search-control">
                    <label class="sr-only" for="creative-search">Search creative works</label>
                    <div class="input-shell">
                        <svg class="icon icon-inline" aria-hidden="true"><use xlink:href="/icons/sprite.svg#search"></use></svg>
                        <input id="creative-search" type="search" name="search" placeholder="Search title, author, or theme..." autocomplete="off">
                    </div>
                </div>

                <div class="control select-control">
                    <label class="sr-only" for="creative-sort">Sort creative works</label>
                    <select id="creative-sort" class="sort-select">
                        <option value="newest">Newest first</option>
                        <option value="oldest">Oldest first</option>
                        <option value="title">Title A–Z</option>
                    </select>
                </div>

                <button type="button" class="ghost-button" id="creative-reset">Reset</button>

                <div class="results-pill" id="creative-results-count" role="status" aria-live="polite">
                    Showing {{ len .Pages }} pieces
                </div>
            </div>
        </div>

        <div class="creative-empty is-hidden" id="creative-empty" role="status" aria-live="polite">
            <p>No pieces match those filters yet.</p>
            <button type="button" class="cta-button" data-reset-filters>Show everything</button>
        </div>

        <div class="creative-grid" id="creative-grid">
            {{ range $sortedDesc }}
            <article class="creative-card"
                data-category="{{ urlize .Params.category }}"
                data-theme="{{ urlize .Params.theme }}"
                data-year="{{ .Params.year }}"
                data-search="{{ printf "%s %s %s %s %s" .Title .Params.description .Params.author .Params.theme .Params.category | plainify | lower }}">
                <div class="card-inner">
                    <!-- Card front -->
                    <div class="card-front">
                        {{ with .Params.image }}
                        <figure class="card-media">
                            <img src="{{ . | relURL }}" alt="{{ $.Params.imageAlt | default (printf "%s artwork" $.Title) }}">
                        </figure>
                        {{ end }}

                        <div class="card-badge">
                            {{ if eq (urlize .Params.category) "poetry" }}
                                <svg class="icon icon-badge" aria-hidden="true"><use xlink:href="/icons/sprite.svg#pen"></use></svg>
                            {{ else if eq (urlize .Params.category) "resilience" }}
                                <svg class="icon icon-badge" aria-hidden="true"><use xlink:href="/icons/sprite.svg#spark"></use></svg>
                            {{ else if eq (urlize .Params.category) "wisdom" }}
                                <svg class="icon icon-badge" aria-hidden="true"><use xlink:href="/icons/sprite.svg#palette"></use></svg>
                            {{ else if eq (urlize .Params.category) "art" }}
                                <svg class="icon icon-badge" aria-hidden="true"><use xlink:href="/icons/sprite.svg#palette"></use></svg>
                            {{ else }}
                                <svg class="icon icon-badge" aria-hidden="true"><use xlink:href="/icons/sprite.svg#home"></use></svg>
                            {{ end }}
                            <span class="badge-text">{{ .Params.category | title }}</span>
                        </div>

                        <div class="card-icon">
                            {{ if eq (urlize .Params.category) "poetry" }}
                                <svg class="icon icon-card" aria-hidden="true"><use xlink:href="/icons/sprite.svg#pen"></use></svg>
                            {{ else if eq (urlize .Params.category) "resilience" }}
                                <svg class="icon icon-card" aria-hidden="true"><use xlink:href="/icons/sprite.svg#spark"></use></svg>
                            {{ else if eq (urlize .Params.category) "wisdom" }}
                                <svg class="icon icon-card" aria-hidden="true"><use xlink:href="/icons/sprite.svg#palette"></use></svg>
                            {{ else if eq (urlize .Params.category) "art" }}
                                <svg class="icon icon-card" aria-hidden="true"><use xlink:href="/icons/sprite.svg#palette"></use></svg>
                            {{ else }}
                                <svg class="icon icon-card" aria-hidden="true"><use xlink:href="/icons/sprite.svg#home"></use></svg>
                            {{ end }}
                        </div>

                        <h2 class="card-title">{{ .Title }}</h2>
                        <p class="card-author">by {{ .Params.author }}</p>
                        <div class="card-meta">
                            <span class="card-theme">{{ .Params.theme }}</span>
                            <span class="card-year">{{ .Params.year }}</span>
                        </div>
                        <p class="card-description">{{ .Params.description }}</p>
                        {{ with index .Params.lines 0 }}
                        <p class="card-preview">&ldquo;{{ . }}&rdquo;</p>
                        {{ end }}
                        <button class="read-more-btn" aria-label="Read {{ .Title }}">Read</button>
                    </div>

                    <!-- Card back -->
                    <div class="card-back">
                        <div class="poem-content">
                            {{ if .Params.lines }}
                            <div class="poem-lines">
                                {{ range .Params.lines }}
                                <p class="poem-line">{{ . }}</p>
                                {{ end }}
                            </div>
                            {{ else }}
                            {{ .Content }}
                            {{ end }}
                        </div>
                        <button class="close-btn" aria-label="Close">×</button>
                    </div>
                </div>
            </article>
            {{ end }}
        </div>
    </div>
</section>
{{ end }}

{{ define "page-scripts" }}
<script src="/js/creative.js" defer></script>
{{ end }}
